(()=>{class e{constructor(e){this.storage=e,this.checks=[]}addCheck(e){this.checks.push(e)}checkModel(e,t){const s=this.checks.find((t=>t.model==e));if(s){const e=this.#e(s.unique,t),n=this.storage.getModels(e),o=this.#t(t,n,s.params);return this.storage.storeModel(e,t),o}}#t(e,t,s){const n={};return t.forEach((t=>{s.forEach((s=>{t[s]!=e[s]&&(n[s]=n[s]||new Set,n[s].add(this.#s(t[s])),n[s].add(this.#s(e[s])))}))})),Object.keys(n).forEach((e=>{n[e]=Array.from(n[e].values())})),Object.keys(n).length?n:null}#e(e,t){return e.map((e=>t[e])).join("-")}#s(e){return"string"==typeof e?`"${e}"`:null===e?"null":void 0===e?"undefined":e}}class t{constructor(e,t){this.storage=t,this.settings=e}onEvent(e){const t=e[this.settings.params.id],s=this.#n(e.event),n={};if(s&&t){const o=this.storage.getForm(t)||{lastInputs:{}},r=this.settings.forms.find((e=>e.id==t)),i=e[this.settings.params.stepName],a=e[this.settings.params.fieldName],l=e[this.settings.params.fieldValue],c=this.#o(e[this.settings.params.inputElement]);switch(!!this.settings.forms.find((e=>e.id===t))||(n[this.settings.params.id]=`unknown form '${t}' - known forms are: ${this.settings.forms.map((e=>e.id)).join(", ")}`),s){case"start":o.inProgress&&(n.event="start event already detected for this form"),o.inProgress=!0;break;case"complete":case"abandon":o.inProgress||(n.event=`form not started: ${t}`),o.inProgress=!1;break;case"step":case"field":case"error":case"submit":o.inProgress||(n.event=`form not started: ${t}`)}switch(s){case"step":i&&(r.steps?.length&&!r.steps.includes(i)&&(n[this.settings.params.stepName]=`unknown step '${i}' - known steps are: ${r.steps.join(", ")}`),o.lastStepName==i&&(n[this.settings.params.stepName]="already on this step"),o.lastStepName=i);break;case"field":if(a&&c){c==o.lastInputs[a]&&(n.event="field value has not changed since last event"),o.lastInputs[a]=c}if(a&&l){const e=this.#r(a,l);console.log("grrr",e),e&&(n[this.settings.params.fieldValue]="potential PII detected - should this be undefined?")}}o.lastEventId=s,this.storage.storeForm(t,o)}return n}#r(e,t){return!!t&&(!!/.+\@.+\..+/i.test(t)||(e=e.toLowerCase(),-1!=["first name","last name","name","email","email address","phone","telephone","phone number","mobile","mobile number","dob","date of birth"].indexOf(e)))}#o(e){if(e&&e instanceof HTMLElement&&["INPUT","TEXTAREA","SELECT"].includes(e.tagName))return e.value}#n(e){const t=this.settings.events;for(let s in t)if(t[s]==e)return s}}class s{static TYPE_STRING="string";static TYPE_ARRAY="array";static TYPE_OBJECT="object";static TYPE_BOOLEAN="boolean";static TYPE_INTEGER="integer";static TYPE_DECIMAL2="decimal2";static TYPE_DECIMAL="decimal";static TYPE_INPUT_ELEMENT="input element";static TYPE_HTML_ELEMENT="html element";static TYPE_UNDEFINED="undefined";static TYPE_UNKNOWN="unknown";constructor(e){this.config=e,this.config.events.forEach((e=>{if(e.params=e.params||[],e.model){const t=this.getModelParamSchemas(e.model);e.params.forEach((e=>{for(let s=0;s<t.length;s++)t[s].key==e.key&&(t.splice(s,1),s--)})),e.params=[...t,...e.params]}}))}getModelConsistency(){return this.config.modelConsistency||[]}findEventNameFromAliases(e){if(!this.config.eventAliases)return null;for(let t=0;t<this.config.eventAliases.length;t++){const s=this.config.eventAliases[t];if(e.event==[s.event])return{value:e[s.alias],alias:s.alias}}}isInitialData(e){if(!this.config.initialData)return!1;if(e.event&&!this.config.initialData.events.includes(e.event))return!1;let t=0;const s=this.config.initialData.identifiedBy;for(let n=0;n<s.length;n++)null!=e[s[n]]&&t++;return t===s.length}isIgnoredEvent(e){if(!e||!this.config.ignoredEvents)return!1;for(let t=0;t<this.config.ignoredEvents.length;t++){const s=this.config.ignoredEvents[t];if(new RegExp(s,"i").test(e))return!0}return!1}isValidEventNameFormat(e){if(!e||!this.config.globalEventNameValidation)return!0;for(let t=0;t<this.config.globalEventNameValidation.length;t++){const s=this.config.globalEventNameValidation[t];if(!new RegExp(s).test(e))return!1}return!0}findEventSchema(e){return this.config.events.find((t=>{if(!t.identify)return!1;for(let s=0;s<t.identify.length;s++){const n=t.identify[s];if(!e.hasOwnProperty(n.key))return!1;const o=String(e[n.key])||"";if(!new RegExp(n.matcher).test(o))return!1}return!0}))}getModelParamSchemas(e){return(this.config.models[e]||[]).slice(0)}getIgnoredParams(){return this.config.ignoredParams||[]}getUnknownParamSchemasForObj(e,t){t=t||[];const s=[];return Object.keys(e).forEach((n=>{this.getIgnoredParams().includes(n)||t.find((e=>e.key===n))||s.push({nonSchema:!0,key:n,type:this.getInferedType(e[n])})})),s}getInferedType(e){return e instanceof HTMLElement?["INPUT","TEXTAREA","SELECT"].includes(e.tagName)?s.TYPE_INPUT_ELEMENT:s.TYPE_HTML_ELEMENT:Array.isArray(e)?s.TYPE_ARRAY:"object"==typeof e?s.TYPE_OBJECT:"string"==typeof e?s.TYPE_STRING:"boolean"==typeof e?s.TYPE_BOOLEAN:"number"==typeof e?Math.round(e)===e?s.TYPE_INTEGER:Number(e.toFixed(2))===e?s.TYPE_DECIMAL2:s.TYPE_DECIMAL:null==e?s.TYPE_UNDEFINED:s.TYPE_UNKNOWN}typesMatch(e,t){let n=this.getInferedType(e);if(n===t)return!0;if([s.TYPE_INTEGER,s.TYPE_DECIMAL,s.TYPE_DECIMAL2].includes(t)&&n===s.TYPE_STRING){const t=Number(e);isNaN(t)||(n=this.getInferedType(t))}return!(t!=s.TYPE_BOOLEAN||!["true","false"].includes(e))||(n===s.TYPE_INTEGER&&(t===s.TYPE_DECIMAL2||t===s.TYPE_DECIMAL)||n===s.TYPE_DECIMAL2&&t===s.TYPE_DECIMAL)}}class n{constructor(e,t="black"){this.console=e,this.bgCol=t,this.args=[],this.styles=[],this.bgCol="black",this.strike=!1}setStrike(e){return this.strike=!!e,this}pushStyled(e,t,s=!1,n="12px",o="black"){return this.args.push(`%c${e}`),this.styles.push(`font-size: ${n}; ${s?"font-style: italic;":""} ${t?"color: "+t+";":""} padding-left: 4px; background: ${o}; text-decoration: ${this.strike?"line-through":"none"};`),this}pushKey(e){return this.pushStyled(e,"aqua")}pushType(e){return this.pushStyled(e,"grey")}pushIssue(e){return this.pushStyled(e,"lightcoral")}pushValue(e){return this.pushStyled(e,"lightskyblue")}pushTick(){return this.pushStyled("✔️ ok","lime")}pushX(){return this.pushStyled("❌","red")}pushWarn(){return this.pushStyled("⚠️","yellow")}log(){this.console.log(...this.#i(arguments)),this.args=[],this.styles=[]}group(){this.console.group(...this.#i(arguments)),this.args=[],this.styles=[]}groupCollapsed(){this.console.groupCollapsed(...this.#i(arguments)),this.args=[],this.styles=[]}groupEnd(){this.console.groupEnd()}#i(e){const t=[this.args.join(""),...this.styles];return e&&t.push(...e),t}}class o{constructor(){this.logger=new n(window.console)}logWelcome(e,t){this.logger.pushStyled("DL VALIDATOR: INFO (click to expand)","lightgreen").groupCollapsed(),this.logger.pushStyled(`Client: ${e.client}\nProject: ${e.name}\nSchema version: ${e.version}\nSchema template version: ${e.templateVersion}\nTool compatability: ${e.libVersion}`,"lightgreen").log(),this.logger.pushStyled("Please set your dev tools to use the Dark theme for better display","yellow").log(),e.downloadableReport&&(this.logger.pushStyled(`Number of stored results: ${t}`,"red").log(),this.logger.pushStyled("To download stored results, press CTRL+SHIFT+L (windows) or COMMAND+SHIFT+L (mac)\nTo clear stored results, press CTRL+SHIFT+K (windows) or COMMAND+SHIFT+K (mac)","salmon").log(),this.logger.pushStyled("IMPORTANT: Make sure to click somewhere on the webpage before pressing the key combo","red").log()),this.logger.groupEnd()}logResult(e){this.logger.setStrike(!1).pushStyled("DL VALIDATOR: ","yellow").pushStyled(`${e.name||"(unknown event)"}`,"black",!1,"12px","yellow").group(),this.logger.pushStyled("page:","white").pushStyled(e.page,"lightgrey",!0).log(),e.params.forEach((e=>this.#a(e))),this.logger.groupEnd()}#a(e,t){if(e.type===s.TYPE_ARRAY||e.type===s.TYPE_OBJECT){const t=this.#l(e);this.logger.pushKey(e.schema.key).pushType(t),e.schema.nonSchema?this.logger.pushWarn().pushStyled("unknown","yellow"):(!0===e.ok&&this.logger.pushTick(),!1===e.ok&&this.logger.pushX(),e.issue&&this.logger.pushIssue(e.issue)),this.logger.group();Object.keys(e.children).forEach((t=>this.#a(e.children[t],e.consistency))),this.logger.groupEnd()}else{let n=e.value;[s.TYPE_INPUT_ELEMENT,s.TYPE_HTML_ELEMENT].includes(e.schema.type)?n=`<${e.value.tagName.toLowerCase()}>`:"string"===e.schema.type&&"(not set)"!=n&&(n='"'+n+'"'),this.logger.pushKey(e.schema.key).pushType(e.schema.type).pushValue(n),e.schema.nonSchema?this.logger.pushWarn().pushStyled("unknown","yellow"):(!0===e.ok&&"(not set)"!=e.value&&this.logger.pushTick(),!1===e.ok&&this.logger.pushX(),e.issue&&this.logger.pushIssue(e.issue)),this.logger.log(),t&&t[e.schema.key]&&this.logger.pushWarn().pushStyled(`inconsistent ${e.schema.key} detected across events: `,"palegoldenrod").log(t[e.schema.key].join(" | "))}}#l(e){const t=e.type===s.TYPE_ARRAY?e.value.length:Object.keys(e.value).length;return e.type===s.TYPE_ARRAY?`array[${t}] (${e.schema.nonSchema?"unknown":e.schema.itemType})`:`object[${t}]`}}
/**! 
 * hotkeys-js v3.10.2 
 * A simple micro-library for defining and dispatching keyboard shortcuts. It has no dependencies. 
 * 
 * Copyright (c) 2023 kenny wong <wowohoo@qq.com> 
 * http://jaywcjlove.github.io/hotkeys 
 * Licensed under the MIT license 
 */
var r="undefined"!=typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;function i(e,t,s,n){e.addEventListener?e.addEventListener(t,s,n):e.attachEvent&&e.attachEvent("on".concat(t),(function(){s(window.event)}))}function a(e,t){for(var s=t.slice(0,t.length-1),n=0;n<s.length;n++)s[n]=e[s[n].toLowerCase()];return s}function l(e){"string"!=typeof e&&(e="");for(var t=(e=e.replace(/\s/g,"")).split(","),s=t.lastIndexOf("");s>=0;)t[s-1]+=",",t.splice(s,1),s=t.lastIndexOf("");return t}for(var c={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":r?173:189,"=":r?61:187,";":r?59:186,"'":222,"[":219,"]":221,"\\":220},h={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},u={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},p={16:!1,18:!1,17:!1,91:!1},d={},g=1;g<20;g++)c["f".concat(g)]=111+g;var f=[],m=!1,y="all",E=[],v=function(e){return c[e.toLowerCase()]||h[e.toLowerCase()]||e.toUpperCase().charCodeAt(0)};function w(e){y=e||"all"}function k(){return y||"all"}var T=function(e){var t=e.key,s=e.scope,n=e.method,o=e.splitKey,r=void 0===o?"+":o;l(t).forEach((function(e){var t=e.split(r),o=t.length,i=t[o-1],l="*"===i?"*":v(i);if(d[l]){s||(s=k());var c=o>1?a(h,t):[];d[l]=d[l].filter((function(e){return!((!n||e.method===n)&&e.scope===s&&function(e,t){for(var s=e.length>=t.length?e:t,n=e.length>=t.length?t:e,o=!0,r=0;r<s.length;r++)-1===n.indexOf(s[r])&&(o=!1);return o}(e.mods,c))}))}}))};function S(e,t,s,n){var o;if(t.element===n&&(t.scope===s||"all"===t.scope)){for(var r in o=t.mods.length>0,p)Object.prototype.hasOwnProperty.call(p,r)&&(!p[r]&&t.mods.indexOf(+r)>-1||p[r]&&-1===t.mods.indexOf(+r))&&(o=!1);(0!==t.mods.length||p[16]||p[18]||p[17]||p[91])&&!o&&"*"!==t.shortcut||!1===t.method(e,t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0))}}function O(e,t){var s=d["*"],n=e.keyCode||e.which||e.charCode;if(P.filter.call(this,e)){if(93!==n&&224!==n||(n=91),-1===f.indexOf(n)&&229!==n&&f.push(n),["ctrlKey","altKey","shiftKey","metaKey"].forEach((function(t){var s=u[t];e[t]&&-1===f.indexOf(s)?f.push(s):!e[t]&&f.indexOf(s)>-1?f.splice(f.indexOf(s),1):"metaKey"===t&&e[t]&&3===f.length&&(e.ctrlKey||e.shiftKey||e.altKey||(f=f.slice(f.indexOf(s))))})),n in p){for(var o in p[n]=!0,h)h[o]===n&&(P[o]=!0);if(!s)return}for(var r in p)Object.prototype.hasOwnProperty.call(p,r)&&(p[r]=e[u[r]]);e.getModifierState&&(!e.altKey||e.ctrlKey)&&e.getModifierState("AltGraph")&&(-1===f.indexOf(17)&&f.push(17),-1===f.indexOf(18)&&f.push(18),p[17]=!0,p[18]=!0);var i=k();if(s)for(var a=0;a<s.length;a++)s[a].scope===i&&("keydown"===e.type&&s[a].keydown||"keyup"===e.type&&s[a].keyup)&&S(e,s[a],i,t);if(n in d)for(var l=0;l<d[n].length;l++)if(("keydown"===e.type&&d[n][l].keydown||"keyup"===e.type&&d[n][l].keyup)&&d[n][l].key){for(var c=d[n][l],g=c.splitKey,m=c.key.split(g),y=[],E=0;E<m.length;E++)y.push(v(m[E]));y.sort().join("")===f.sort().join("")&&S(e,c,i,t)}}}function P(e,t,s){f=[];var n=l(e),o=[],r="all",c=document,u=0,g=!1,y=!0,w="+",k=!1;for(void 0===s&&"function"==typeof t&&(s=t),"[object Object]"===Object.prototype.toString.call(t)&&(t.scope&&(r=t.scope),t.element&&(c=t.element),t.keyup&&(g=t.keyup),void 0!==t.keydown&&(y=t.keydown),void 0!==t.capture&&(k=t.capture),"string"==typeof t.splitKey&&(w=t.splitKey)),"string"==typeof t&&(r=t);u<n.length;u++)o=[],(e=n[u].split(w)).length>1&&(o=a(h,e)),(e="*"===(e=e[e.length-1])?"*":v(e))in d||(d[e]=[]),d[e].push({keyup:g,keydown:y,scope:r,mods:o,shortcut:n[u],method:s,key:n[u],splitKey:w,element:c});void 0!==c&&!function(e){return E.indexOf(e)>-1}(c)&&window&&(E.push(c),i(c,"keydown",(function(e){O(e,c)}),k),m||(m=!0,i(window,"focus",(function(){f=[]}),k)),i(c,"keyup",(function(e){O(e,c),function(e){var t=e.keyCode||e.which||e.charCode,s=f.indexOf(t);if(s>=0&&f.splice(s,1),e.key&&"meta"===e.key.toLowerCase()&&f.splice(0,f.length),93!==t&&224!==t||(t=91),t in p)for(var n in p[t]=!1,h)h[n]===t&&(P[n]=!1)}(e)}),k))}var b={getPressedKeyString:function(){return f.map((function(e){return t=e,Object.keys(c).find((function(e){return c[e]===t}))||function(e){return Object.keys(h).find((function(t){return h[t]===e}))}(e)||String.fromCharCode(e);var t}))},setScope:w,getScope:k,deleteScope:function(e,t){var s,n;for(var o in e||(e=k()),d)if(Object.prototype.hasOwnProperty.call(d,o))for(s=d[o],n=0;n<s.length;)s[n].scope===e?s.splice(n,1):n++;k()===e&&w(t||"all")},getPressedKeyCodes:function(){return f.slice(0)},isPressed:function(e){return"string"==typeof e&&(e=v(e)),-1!==f.indexOf(e)},filter:function(e){var t=e.target||e.srcElement,s=t.tagName,n=!0;return!t.isContentEditable&&("INPUT"!==s&&"TEXTAREA"!==s&&"SELECT"!==s||t.readOnly)||(n=!1),n},trigger:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";Object.keys(d).forEach((function(s){d[s].filter((function(s){return s.scope===t&&s.shortcut===e})).forEach((function(e){e&&e.method&&e.method()}))}))},unbind:function(e){if(void 0===e)Object.keys(d).forEach((function(e){return delete d[e]}));else if(Array.isArray(e))e.forEach((function(e){e.key&&T(e)}));else if("object"==typeof e)e.key&&T(e);else if("string"==typeof e){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];var o=s[0],r=s[1];"function"==typeof o&&(r=o,o=""),T({key:e,scope:o,method:r,splitKey:"+"})}},keyMap:c,modifier:h,modifierMap:u};for(var A in b)Object.prototype.hasOwnProperty.call(b,A)&&(P[A]=b[A]);if("undefined"!=typeof window){var I=window.hotkeys;P.noConflict=function(e){return e&&window.hotkeys===P&&(window.hotkeys=I),P},window.hotkeys=P}class N{static STORAGE_KEY="downloader-logs";constructor(e){this.client=e.client,this.name=e.name,this.schemaVersion=e.version,this.libVersion=e.libVersion,this.logs=localStorage.getItem(N.STORAGE_KEY)||"[]",this.logs=JSON.parse(this.logs),P("ctrl+shift+l,command+shift+l",((e,t)=>{this.#c()})),P("ctrl+shift+k,command+shift+k",((e,t)=>{this.#h()}))}logResult(e){this.logs.push(e),localStorage.setItem(N.STORAGE_KEY,JSON.stringify(this.logs))}getStoredResultsCount(){let e=localStorage.getItem(N.STORAGE_KEY)||"[]";return e=JSON.parse(e),e.length}#h(){this.logs=[],localStorage.removeItem(N.STORAGE_KEY),alert("All DL validation results cleared from storage")}#c(){const e="index,page,internal name,property,value,expected type,expected case,validation,example,description,,status,note".split(","),t=[];for(let e=0;e<this.logs.length;e++){const t=this.logs[e],n=e+1,o=t.name||"(unknown)",r=t.page;t.params.forEach((e=>s(e,n,o,r)))}function s(n,o,r,i,a=""){const l=new Array(e.length).fill("");l[e.indexOf("index")]=o,l[e.indexOf("internal name")]=r,l[e.indexOf("page")]=i,l[e.indexOf("expected case")]=n.schema.lowercase?"lowercase":n.schema.uppercase?"uppercase":"any",l[e.indexOf("validation")]=n.schema.validation?n.schema.validation.join(" // "):"",l[e.indexOf("example")]=n.schema.example||"",l[e.indexOf("description")]=n.schema.description||"";const c=a?a+"."+n.schema.key:n.schema.key;if(l[e.indexOf("property")]=c,n.schema.nonSchema||(l[e.indexOf("expected type")]=n.schema.type),"object"!=typeof n.value&&(l[e.indexOf("value")]=n.value),n.schema.nonSchema||(l[e.indexOf("status")]=!0===n.ok?"OK":!1===n.ok?"KO":""),n.schema.nonSchema||(l[e.indexOf("note")]=n.issue||""),t.push(l),["array","object"].includes(n.schema.type)&&!n.schema.nonSchema){Object.keys(n.children).forEach((e=>s(n.children[e],o,r,i,c)))}}const n=e.join("\t")+"\n"+t.map((e=>e.join("\t"))).join("\n");var o,r,i;o=`${window.location.hostname}-${this.client}-${this.name}-v${this.schemaVersion}-${(new Date).toDateString()}.csv`,r=n,(i=document.createElement("a")).setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(r)),i.setAttribute("download",o),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)}}class C{constructor(n,r,i){n.dataLayer=n.dataLayer||[],this.schema=new s(r),this.storage=i,this.consistency=new e(this.storage),this.schema.getModelConsistency().forEach((e=>this.consistency.addCheck(e))),this.schema.formSettings&&(this.formCheck=new t(this.schema.formSettings,this.storage)),this.display=new o,r.downloadableReport&&(this.downloader=new N(r)),this.display.logWelcome(r,this.downloader?this.downloader.getStoredResultsCount():null)}reset(){this.storage.clearAllModels()}#u(e,t){t=t||[];for(let s=0;s<t.length;s++){if(!new RegExp(t[s],"i").test(e))return s}return-1}#p(e){return!(e=e.toLowerCase()).length||"null"==e||"undefined"==e}#d(e,t){const n={schema:t,value:e[t.key],ok:!0,children:{}};t.required&&!e.hasOwnProperty(t.key)&&(n.ok=!1,n.issue="required param is missing");const o=e[t.key];if(null!=o){const e=this.schema.getInferedType(o);if(n.type=e,t.nonSchema||this.schema.typesMatch(o,t.type))if(e===s.TYPE_STRING)if(this.schema.config.flagAsianChars&&o&&!this.#g(o))n.ok=!1,n.issue="only latin characters allowed in value";else{const e=this.#u(o,t.validation);-1!=e?(n.ok=!1,n.issue="should match regex: "+t.validation[e]):t.uppercase&&!this.#f(o)?(n.ok=!1,n.issue="value must be all upper case"):t.lowercase&&!this.#m(o)?(n.ok=!1,n.issue="value must be all lower case"):this.#p(o)&&(n.ok=!1,n.issue="avoid using empty strings or null/undefined wrapped in strings, please use raw undefined instead")}else if(e===s.TYPE_ARRAY)o.length?(n.ok=null,o.forEach(((e,s)=>{n.children[s]=this.#d(o,{key:s,nonSchema:t.nonSchema,type:t.itemType,model:t.model,required:!0})}))):t.required&&(n.ok=!1,n.issue="at least one item is required");else if(e===s.TYPE_OBJECT){n.ok=null;let e=[];if(t.model){const s=this.schema.getModelParamSchemas(t.model),r=this.schema.getUnknownParamSchemasForObj(o,s);e=[...s,...r],n.consistency=this.consistency.checkModel(t.model,o)}if(t.properties){const s=this.schema.getUnknownParamSchemasForObj(o,t.properties);e=[...t.properties,...s]}e.forEach(((e,t)=>{n.children[e.key]=this.#d(o,e)}))}else s.TYPE_UNDEFINED;else n.ok=!1,n.issue="should be of type "+t.type}else e.hasOwnProperty(t.key)||(n.value="(not set)");return n}#g(e){return/^[\w\s\p{P}\u00C0-\u02AF]+$/u.test(e)}#f(e){return e===e.toUpperCase()}#m(e){return e===e.toLowerCase()}onDataLayerMessage(e){if("object"!=typeof e||Array.from(e).length)return;if(this.schema.isIgnoredEvent(e.event))return;const t={msg:e,params:[]},s=this.schema.findEventSchema(e);if(s){t.name=s.name;const n=this.schema.getUnknownParamSchemasForObj(e,s.params);t.params=[...s.params,...n].map((t=>this.#d(e,t)))}else{const s=this.schema.getUnknownParamSchemasForObj(e);t.params=s.map((t=>this.#d(e,t)))}if(this.formCheck){const s=this.formCheck.onEvent(e);s.event,t.params.forEach((e=>{!1!==e.ok&&s[e.schema.key]&&(e.ok=!1,e.issue=s[e.schema.key])}))}t.page=window.location.pathname,this.downloader&&this.downloader.logResult(t),this.display.logResult(t)}}class _{static MODELS="dlval-models";static FORMS="dlval-forms";constructor(e=!1){e||(this.clearAllForms(),this.clearAllModels())}getForm(e){return this.getAllForms()[e]}storeForm(e,t){const s=this.getAllForms();s[e]=t,localStorage.setItem(_.FORMS,JSON.stringify(s))}getAllForms(){const e=localStorage.getItem(_.FORMS)||"{}";return JSON.parse(e)}clearAllForms(){localStorage.removeItem(_.FORMS)}storeModel(e,t){const s=this.getAllModels(),n=s[e]||[],o=JSON.stringify(t);for(let e=0;e<n.length;e++){if(o==JSON.stringify(n[e]))return}n.push(t),s[e]=n,localStorage.setItem(_.MODELS,JSON.stringify(s))}getAllModels(){const e=localStorage.getItem(_.MODELS)||"{}";return JSON.parse(e)}getModels(e){return this.getAllModels()[e]||[]}clearAllModels(){localStorage.removeItem(_.MODELS)}}!function(){"use strict";var e=/\[object (Boolean|Number|String|Function|Array|Date|RegExp|Arguments)\]/;function t(t){return null==t?String(t):(t=e.exec(Object.prototype.toString.call(Object(t))))?t[1].toLowerCase():"object"}function s(e,t){return Object.prototype.hasOwnProperty.call(Object(e),t)}function n(e){if(!e||"object"!=t(e)||e.nodeType||e==e.window)return!1;try{if(e.constructor&&!s(e,"constructor")&&!s(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}for(var n in e);return void 0===n||s(e,n)}function o(e,t){var s={},n=s;e=e.split(".");for(var o=0;o<e.length-1;o++)n=n[e[o]]={};return n[e[e.length-1]]=t,s}function r(e,o){var i,a=!e._clear;for(i in e)if(s(e,i)){var l=e[i];"array"===t(l)&&a?("array"===t(o[i])||(o[i]=[]),r(l,o[i])):n(l)&&a?(n(o[i])||(o[i]={}),r(l,o[i])):o[i]=l}delete o._clear}function i(e,t,s){t="function"==typeof(t=void 0===t?{}:t)?{listener:t,listenToPast:void 0!==s&&s,processNow:!0,commandProcessors:{}}:{listener:t.listener||function(){},listenToPast:t.listenToPast||!1,processNow:void 0===t.processNow||t.processNow,commandProcessors:t.commandProcessors||{}},this.a=e,this.l=t.listener,this.j=t.listenToPast,this.g=this.i=!1,this.c={},this.f=[],this.b=t.commandProcessors,this.h=function(e){return{set:function(t,s){r(o(t,s),e.c)},get:function(t){return e.get(t)}}}(this);var n=this.a.push,i=this;this.a.push=function(){var e=[].slice.call(arguments,0),t=n.apply(i.a,e);return a(i,e),t},t.processNow&&this.process()}function a(e,s,i){if(i=void 0!==i&&i,e.i&&(e.f.push.apply(e.f,s),!e.g))for(;0<e.f.length;){if("array"===t(s=e.f.shift()))e:{var a=e.c;t(s[0]);for(var l=s[0].split("."),c=l.pop(),h=s.slice(1),u=0;u<l.length;u++){if(void 0===a[l[u]])break e;a=a[l[u]]}try{a[c].apply(a,h)}catch(e){}}else if("arguments"===t(s)){if(l=e,c=[],h=s[0],l.b[h])for(a=l.b[h].length,u=0;u<a;u++)c.push(l.b[h][u].apply(l.h,[].slice.call(s,1)));e.f.push.apply(e.f,c)}else if("function"==typeof s)try{s.call(e.h)}catch(e){}else{if(!n(s))continue;for(var p in s)r(o(p,s[p]),e.c)}i||(e.g=!0,e.l(e.c,s),e.g=!1)}}i.prototype.process=function(){this.registerProcessor("set",(function(){var e={};return 1===arguments.length&&"object"===t(arguments[0])?e=arguments[0]:2===arguments.length&&"string"===t(arguments[0])&&(e=o(arguments[0],arguments[1])),e})),this.i=!0;for(var e=this.a.length,s=0;s<e;s++)a(this,[this.a[s]],!this.j)},i.prototype.get=function(e){var t=this.c;e=e.split(".");for(var s=0;s<e.length;s++){if(void 0===t[e[s]])return;t=t[e[s]]}return t},i.prototype.flatten=function(){this.a.splice(0,this.a.length),this.a[0]={},r(this.c,this.a[0])},i.prototype.registerProcessor=function(e,t){e in this.b||(this.b[e]=[]),this.b[e].push(t)},i.prototype.registerProcessor=i.prototype.registerProcessor,i.prototype.flatten=i.prototype.flatten,i.prototype.get=i.prototype.get,i.prototype.process=i.prototype.process,window.DataLayerHelper=i}(),window.initDataLayerValidator=e=>{const t="0.3.0";function s(e){const s=new _,n=new C(window,e,s);t!=e.libVersion&&console.error(`DL VALIDATOR: This schema template version may not compatible with the validator version (v${t}) loaded on this page.`),window.dataLayer=window.dataLayer||[];new DataLayerHelper(window.dataLayer,{listenToPast:!0,listener:(e,t)=>n.onDataLayerMessage(t)})}"string"==typeof e?fetch(e).then((e=>e.json())).then((e=>{s(e)})):"object"==typeof e&&s(e)}})();
